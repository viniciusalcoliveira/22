<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIO ADMIN | High-End Control</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/imask"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        :root {
            --sidebar: #0a0c10;
            --bg: #14171c;
            --card: #1f232b;
            --accent: #FFD700;
            --text: #ffffff;
            --text-dim: #a0aec0;
            --border: #2d3748;
            --success: #22c55e;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: var(--text); display: flex; min-height: 100vh; }

        /* --- SIDEBAR --- */
        aside { width: 260px; background: var(--sidebar); border-right: 1px solid var(--border); padding: 30px 20px; display: flex; flex-direction: column; }
        .logo { font-size: 24px; font-weight: 800; margin-bottom: 50px; letter-spacing: -1px; }
        .logo span { color: var(--accent); }
        .nav-link { padding: 12px 15px; border-radius: 8px; color: var(--text-dim); text-decoration: none; margin-bottom: 10px; transition: 0.3s; display: flex; align-items: center; gap: 10px; }
        .nav-link:hover, .nav-link.active { background: var(--card); color: var(--accent); }

        /* --- MAIN CONTENT --- */
        main { flex: 1; padding: 40px; overflow-y: auto; }
        .header-main { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .stat-card { background: var(--card); padding: 25px; border-radius: 16px; border: 1px solid var(--border); }
        .stat-card h4 { color: var(--text-dim); font-size: 12px; text-transform: uppercase; margin-bottom: 10px; }
        .stat-card p { font-size: 28px; font-weight: 800; }

        /* --- FORM & TABLES --- */
        .glass-card { background: var(--card); border-radius: 20px; border: 1px solid var(--border); padding: 30px; margin-bottom: 30px; }
        .grid-inputs { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        
        label { display: block; font-size: 12px; font-weight: 600; color: var(--text-dim); margin-bottom: 8px; }
        input, select, textarea { 
            background: #14171c; border: 1px solid var(--border); padding: 14px; border-radius: 10px; 
            color: white; width: 100%; transition: 0.3s;
        }
        input:focus { border-color: var(--accent); outline: none; box-shadow: 0 0 0 2px rgba(255, 215, 0, 0.2); }

        .btn-primary { 
            background: var(--accent); color: #000; padding: 15px 30px; border-radius: 10px; 
            font-weight: 800; border: none; cursor: pointer; transition: 0.3s; margin-top: 20px;
            width: 100%; text-transform: uppercase;
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3); }

        /* --- PHOTO MANAGER --- */
        .upload-zone { border: 2px dashed var(--border); padding: 30px; border-radius: 15px; text-align: center; margin-top: 10px; transition: 0.3s; }
        .upload-zone:hover { border-color: var(--accent); background: rgba(255,215,0,0.05); }
        .preview-container { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 20px; }
        .thumb { width: 100px; height: 100px; border-radius: 12px; position: relative; border: 2px solid var(--border); }
        .thumb img { width: 100%; height: 100%; object-fit: cover; border-radius: 10px; }
        .thumb-del { position: absolute; -top: 10px; -right: 10px; background: #ff4d4d; border: none; color: white; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; }

        /* --- TABLE STYLE --- */
        table { width: 100%; border-collapse: separate; border-spacing: 0 10px; }
        th { text-align: left; padding: 15px; color: var(--text-dim); font-size: 13px; }
        td { background: #1f232b; padding: 15px; border-top: 1px solid var(--border); border-bottom: 1px solid var(--border); }
        td:first-child { border-left: 1px solid var(--border); border-radius: 15px 0 0 15px; }
        td:last-child { border-right: 1px solid var(--border); border-radius: 0 15px 15px 0; }
        .img-table { width: 80px; height: 50px; object-fit: cover; border-radius: 8px; }

        /* --- MODAL --- */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(5px); z-index: 999; padding: 20px; }
        .modal-content { background: var(--card); max-width: 800px; margin: 2% auto; border-radius: 20px; padding: 40px; position: relative; border: 1px solid var(--border); }
    </style>
</head>
<body>

<aside>
    <div class="logo">SIO<span>VE√çCULOS</span></div>
    <a href="#" class="nav-link active"><i class="fas fa-th-large"></i> Dashboard</a>
    <a href="#" class="nav-link"><i class="fas fa-car"></i> Estoque</a>
    <a href="#" class="nav-link"><i class="fas fa-chart-line"></i> Vendas</a>
    <a href="#" class="nav-link"><i class="fas fa-cog"></i> Configura√ß√µes</a>
</aside>

<main>
    <div class="header-main">
        <h1>Gest√£o de Invent√°rio</h1>
        <div id="relogio"></div>
    </div>

    <div class="stats-grid">
        <div class="stat-card"><h4>No P√°tio</h4><p id="totalStock">0</p></div>
        <div class="stat-card"><h4>Vendas M√™s</h4><p style="color:var(--success)">+R$ 0,00</p></div>
        <div class="stat-card"><h4>Status Servidor</h4><p style="color:var(--accent); font-size: 14px;"><i class="fas fa-circle"></i> Local Ativo</p></div>
    </div>

    <div class="glass-card">
        <h3 style="margin-bottom: 25px;"><i class="fas fa-plus-circle"></i> Cadastrar Novo Ve√≠culo</h3>
        <form id="carForm">
            <div class="grid-inputs">
                <div><label>Marca/Modelo</label><input type="text" id="modelo" placeholder="Ex: BMW 320i M-Sport" required></div>
                <div><label>Pre√ßo de Venda</label><input type="text" id="valor" placeholder="R$ 0,00" required></div>
                <div><label>Ano/Modelo</label><input type="text" id="ano" placeholder="2024/2024"></div>
                <div><label>Quilometragem</label><input type="text" id="km" placeholder="0 km"></div>
                <div>
                    <label>Condi√ß√£o</label>
                    <select id="modalidade">
                        <option value="Premium">üíé Premium (Garantia)</option>
                        <option value="Repasse">üö® Repasse (No estado)</option>
                    </select>
                </div>
            </div>

            <div class="upload-zone" onclick="document.getElementById('fotosInput').click()">
                <i class="fas fa-cloud-upload-alt fa-2x" style="color:var(--accent); margin-bottom: 10px;"></i>
                <p>Arraste fotos ou clique para selecionar</p>
                <input type="file" id="fotosInput" multiple accept="image/*" hidden>
            </div>
            <div id="previewArea" class="preview-container"></div>

            <button type="submit" class="btn-primary">Publicar no Estoque Online</button>
        </form>
    </div>

    <div class="glass-card">
        <h3><i class="fas fa-list"></i> P√°tio Digital</h3>
        <table>
            <thead>
                <tr>
                    <th>VE√çCULO</th>
                    <th>PRE√áO</th>
                    <th>MODALIDADE</th>
                    <th>STATUS</th>
                    <th>A√á√ïES</th>
                </tr>
            </thead>
            <tbody id="inventoryListBody"></tbody>
        </table>
    </div>
</main>

<div id="editModal" class="modal">
    <div class="modal-content">
        <h2>Editar Ve√≠culo</h2>
        <form id="editForm">
            <input type="hidden" id="editIndex">
            <div class="grid-inputs" style="margin-top:20px">
                <div><label>Valor Atualizado</label><input type="text" id="editValor"></div>
                <div>
                    <label>Status Comercial</label>
                    <select id="editStatus">
                        <option value="Dispon√≠vel">Dispon√≠vel</option>
                        <option value="Reservado">Reservado</option>
                        <option value="Vendido">Vendido</option>
                    </select>
                </div>
            </div>
            <div id="editPreviewArea" class="preview-container" style="margin-top:20px"></div>
            <div style="display:flex; gap:10px; margin-top:30px">
                <button type="submit" class="btn-primary" style="flex:2">Salvar Altera√ß√µes</button>
                <button type="button" onclick="closeModal()" class="btn-primary" style="flex:1; background:#333; color:white">Fechar</button>
            </div>
        </form>
    </div>
</div>

<script>
    let estoque = JSON.parse(localStorage.getItem('sio_estoque')) || [];
    let fotosTemp = [];

    // M√ÅSCARAS PROFISSIONAIS
    IMask(document.getElementById('valor'), { mask: 'R$ num', blocks: { num: { mask: Number, thousandsSeparator: '.', padFractionalZeros: true, radix: ',' } } });
    IMask(document.getElementById('editValor'), { mask: 'R$ num', blocks: { num: { mask: Number, thousandsSeparator: '.', padFractionalZeros: true, radix: ',' } } });

    // COMPRESS√ÉO DE IMAGEM AUTOM√ÅTICA (Pra n√£o travar o banco)
    async function compressImage(file) {
        return new Promise((resolve) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = (event) => {
                const img = new Image();
                img.src = event.target.result;
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const MAX_WIDTH = 800; // Redimensiona para HD leve
                    const scaleSize = MAX_WIDTH / img.width;
                    canvas.width = MAX_WIDTH;
                    canvas.height = img.height * scaleSize;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    resolve(canvas.toDataURL('image/jpeg', 0.7)); // Qualidade 70%
                };
            };
        });
    }

    document.getElementById('fotosInput').addEventListener('change', async (e) => {
        const files = Array.from(e.target.files);
        for (let file of files) {
            const compressed = await compressImage(file);
            fotosTemp.push(compressed);
        }
        renderPreviews(fotosTemp, 'previewArea');
    });

    function renderPreviews(arr, containerId) {
        const container = document.getElementById(containerId);
        container.innerHTML = arr.map((img, idx) => `
            <div class="thumb">
                <img src="${img}">
                <button type="button" class="thumb-del" onclick="removePhoto(${idx}, '${containerId}')">√ó</button>
            </div>
        `).join('');
    }

    window.removePhoto = (idx, containerId) => {
        if(containerId === 'previewArea') fotosTemp.splice(idx, 1);
        else {
            let carIndex = document.getElementById('editIndex').value;
            estoque[carIndex].fotos.splice(idx, 1);
            renderPreviews(estoque[carIndex].fotos, 'editPreviewArea');
        }
        renderPreviews(fotosTemp, 'previewArea');
    };

    // CRUD
    document.getElementById('carForm').onsubmit = (e) => {
        e.preventDefault();
        const carro = {
            id: Date.now(),
            modelo: document.getElementById('modelo').value,
            valor: document.getElementById('valor').value,
            ano: document.getElementById('ano').value,
            km: document.getElementById('km').value,
            modalidade: document.getElementById('modalidade').value,
            status: 'Dispon√≠vel',
            fotos: [...fotosTemp]
        };
        estoque.push(carro);
        if(save()) {
            Swal.fire('Sucesso!', 'Ve√≠culo publicado.', 'success');
            e.target.reset();
            fotosTemp = [];
            renderPreviews([], 'previewArea');
            renderTable();
        }
    };

    function renderTable() {
        const body = document.getElementById('inventoryListBody');
        document.getElementById('totalStock').innerText = estoque.length;
        body.innerHTML = estoque.map((car, i) => `
            <tr>
                <td>
                    <div style="display:flex; align-items:center; gap:15px">
                        <img src="${car.fotos[0] || ''}" class="img-table">
                        <div><strong>${car.modelo}</strong><br><small style="color:var(--text-dim)">${car.ano} | ${car.km}</small></div>
                    </div>
                </td>
                <td><span style="color:var(--accent); font-weight:800">${car.valor}</span></td>
                <td><span style="font-size:11px; border: 1px solid var(--border); padding:4px 8px; border-radius:5px">${car.modalidade}</span></td>
                <td><span style="color:${car.status === 'Vendido' ? '#ff4d4d' : '#22c55e'}">${car.status}</span></td>
                <td>
                    <button onclick="openEdit(${i})" style="background:none; border:none; color:var(--text-dim); cursor:pointer; margin-right:10px"><i class="fas fa-edit"></i></button>
                    <button onclick="delCar(${i})" style="background:none; border:none; color:#ff4d4d; cursor:pointer"><i class="fas fa-trash"></i></button>
                </td>
            </tr>
        `).join('');
    }

    window.openEdit = (i) => {
        const car = estoque[i];
        document.getElementById('editIndex').value = i;
        document.getElementById('editValor').value = car.valor;
        document.getElementById('editStatus').value = car.status;
        renderPreviews(car.fotos, 'editPreviewArea');
        document.getElementById('editModal').style.display = 'block';
    }

    document.getElementById('editForm').onsubmit = (e) => {
        e.preventDefault();
        const i = document.getElementById('editIndex').value;
        estoque[i].valor = document.getElementById('editValor').value;
        estoque[i].status = document.getElementById('editStatus').value;
        save();
        closeModal();
        renderTable();
    };

    function delCar(i) {
        Swal.fire({
            title: 'Tem certeza?',
            text: "O ve√≠culo ser√° removido permanentemente!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#FFD700',
            cancelButtonColor: '#333',
            confirmButtonText: 'Sim, remover!'
        }).then((result) => {
            if (result.isConfirmed) {
                estoque.splice(i, 1);
                save();
                renderTable();
            }
        });
    }

    function save() {
        try {
            localStorage.setItem('sio_estoque', JSON.stringify(estoque));
            return true;
        } catch(e) {
            Swal.fire('Erro!', 'Limite de mem√≥ria atingido. Remova algumas fotos.', 'error');
            return false;
        }
    }

    function closeModal() { document.getElementById('editModal').style.display = 'none'; }
    window.onload = renderTable;
</script>
</body>
</html>